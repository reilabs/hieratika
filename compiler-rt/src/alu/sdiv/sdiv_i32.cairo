use crate::rtstate::RTState;
use crate::alu::sdiv::sdiv;

pub fn __llvm_sdiv_i_i_i(ref state: RTState, lhs: u128, rhs: u128) -> u128 {
    sdiv::<u32>(lhs, rhs)
}

#[cfg(test)]
mod tests {
    use crate::rtstate::RTStateOps;
    use super::__llvm_sdiv_i_i_i;
    use crate::alu::test_case::TestCaseTwoArgs;
    #[cairofmt::skip]
    pub const test_cases: [TestCaseTwoArgs; 126] = [
        // Due to Cairo's casting limitation, negative numbers are represented as bit patterns.

        // Random test cases
        TestCaseTwoArgs{lhs: 1021192173, rhs: 2118252945, expected: 0},
        TestCaseTwoArgs{lhs: 0b11000110010010110010011011110110, rhs: 62721209, expected: 0b11111111111111111111111111110000}, // lhs = -968153354 expected = -16
        TestCaseTwoArgs{lhs: 1099021956, rhs: 0b11000100100111110100001111111110, expected: 0b11111111111111111111111111111110}, // rhs = -996195330 expected = -2
        TestCaseTwoArgs{lhs: 0b11001010011111101010101101110011, rhs: 1664337888, expected: 0b11111111111111111111111111111111}, // lhs = -897668237 expected = -1
        TestCaseTwoArgs{lhs: 613369602, rhs: 713689853, expected: 0},
        TestCaseTwoArgs{lhs: 0b10000011100010010001011100011000, rhs: 384460661, expected: 0b11111111111111111111111111111010}, // lhs = -2088167656 expected = -6
        TestCaseTwoArgs{lhs: 0b10001001011000101011101000011001, rhs: 0b11000100111100111110011101001111, expected: 2}, // lhs = -1990018535 rhs = -990648497
        TestCaseTwoArgs{lhs: 0b11000000001101101101000010100100, rhs: 374321874, expected: 0b11111111111111111111111111111101}, // lhs = -1070149468 expected = -3
        TestCaseTwoArgs{lhs: 1931339687, rhs: 1234686908, expected: 1},
        TestCaseTwoArgs{lhs: 0b10011111000111100011001100000101, rhs: 1762030365, expected: 0b11111111111111111111111111111111}, // lhs = -1625410811 expected = -1
        TestCaseTwoArgs{lhs: 856224001, rhs: 609690429, expected: 1},
        TestCaseTwoArgs{lhs: 0b11001101001101000100001111001011, rhs: 0b10011011100100010011110110010001, expected: 0}, // lhs = -852212789 rhs = -1684980335
        TestCaseTwoArgs{lhs: 544800601, rhs: 0b11010010011110100101011011001101, expected: 0b11111111111111111111111111111111}, // rhs = -763734323 expected = -1
        TestCaseTwoArgs{lhs: 0b10100001010100001101100001010011, rhs: 0b11011101010000000100100101010100, expected: 2}, // lhs = -1588537261 rhs = -582989484
        TestCaseTwoArgs{lhs: 1169052837, rhs: 1326431026, expected: 0},
        TestCaseTwoArgs{lhs: 0b11011000110010011110011011001111, rhs: 192991957, expected: 0b11111111111111111111111111111100}, // lhs = -657856817 expected = -4
        TestCaseTwoArgs{lhs: 1142437335, rhs: 0b10011101101101000001010001100101, expected: 0b11111111111111111111111111111111}, // rhs = -1649142683 expected = -1
        TestCaseTwoArgs{lhs: 1923822676, rhs: 1689277689, expected: 1},
        TestCaseTwoArgs{lhs: 0b11100101110001101101110001001110, rhs: 0b10001011111110111011010111110101, expected: 0}, // lhs = -439952306 rhs = -1946438155
        TestCaseTwoArgs{lhs: 656298834, rhs: 1219746923, expected: 0},
        TestCaseTwoArgs{lhs: 0b10011010111111100000011001101001, rhs: 0b11011101001100000010010001101011, expected: 2}, // lhs = -1694628247 rhs = -584047509
        TestCaseTwoArgs{lhs: 117389577, rhs: 0b11011100001111111010101011000001, expected: 0b11111111111111111111111111111111}, // rhs = -599807295 expected = -1
        TestCaseTwoArgs{lhs: 1527745859, rhs: 1257515537, expected: 1},
        TestCaseTwoArgs{lhs: 0b11001000011111110000010110110100, rhs: 0b11111011101111001010011100110111, expected: 13}, // lhs = -931199564 rhs = -71522505
        TestCaseTwoArgs{lhs: 1666719058, rhs: 224823389, expected: 7},
        TestCaseTwoArgs{lhs: 2047094103, rhs: 1236988329, expected: 1},
        TestCaseTwoArgs{lhs: 2009622652, rhs: 646662039, expected: 3},
        TestCaseTwoArgs{lhs: 1135973038, rhs: 0b10100010010010011011111000010100, expected: 0b11111111111111111111111111111111}, // rhs = -1572225516 expected = -1
        TestCaseTwoArgs{lhs: 0b10100111001001010101111110100111, rhs: 720731143, expected: 0b11111111111111111111111111111101}, // lhs = -1490722905 expected = -3
        TestCaseTwoArgs{lhs: 475802488, rhs: 0b10100100101100011110110101110111, expected: 0b11111111111111111111111111111111}, // rhs = -1531843209 expected = -1
        TestCaseTwoArgs{lhs: 0b10011001100100010010011101100011, rhs: 1669717659, expected: 0b11111111111111111111111111111110}, // lhs = -1718540445 expected = -2
        TestCaseTwoArgs{lhs: 0b11000001010010000000101001101100, rhs: 348570485, expected: 0b11111111111111111111111111111100}, // lhs = -1052243348 expected = -4
        TestCaseTwoArgs{lhs: 0b11101110010010101101101011110100, rhs: 0b11001011000000011110100001111000, expected: 0}, // lhs = -297084172 rhs = -889067400
        TestCaseTwoArgs{lhs: 1896771388, rhs: 896588034, expected: 2},
        TestCaseTwoArgs{lhs: 0b10001001000110011010001011000111, rhs: 0b11011100011111000000101000001010, expected: 3}, // lhs = -1994808633 rhs = -595850742
        TestCaseTwoArgs{lhs: 0b11011011100011011000100010101010, rhs: 1629717582, expected: 0b11111111111111111111111111111111}, // lhs = -611481430 expected = -1
        TestCaseTwoArgs{lhs: 1997857357, rhs: 1130488917, expected: 1},
        TestCaseTwoArgs{lhs: 1628964516, rhs: 0b11101101011100100110001111001100, expected: 0b11111111111111111111111111111010}, // rhs = -311270452 expected = -6
        TestCaseTwoArgs{lhs: 136811940, rhs: 0b11110010101101111110111001000110, expected: 0b11111111111111111111111111111111}, // rhs = -222826938 expected = -1
        TestCaseTwoArgs{lhs: 1077963539, rhs: 0b10001011101011111110011010100010, expected: 0b11111111111111111111111111111111}, // rhs = -1951406430 expected = -1
        TestCaseTwoArgs{lhs: 0b11100001010100000010101011101110, rhs: 1830548964, expected: 0b11111111111111111111111111111111}, // lhs = -514839826 expected = -1
        TestCaseTwoArgs{lhs: 1427531144, rhs: 0b11010111001000000111001110001010, expected: 0b11111111111111111111111111111101}, // rhs = -685739126 expected = -3
        TestCaseTwoArgs{lhs: 0b11011101010110101010011101101010, rhs: 776170284, expected: 0b11111111111111111111111111111111}, // lhs = -581261462 expected = -1
        TestCaseTwoArgs{lhs: 0b10101001011101101001111100010000, rhs: 1335547595, expected: 0b11111111111111111111111111111110}, // lhs = -1451843824 expected = -2
        TestCaseTwoArgs{lhs: 895885866, rhs: 1649942757, expected: 0},
        TestCaseTwoArgs{lhs: 0b11111010000110011110001001111110, rhs: 0b11100111110010100011011000001100, expected: 0}, // lhs = -98966914 rhs = -406178292
        TestCaseTwoArgs{lhs: 598850446, rhs: 0b11110100000100000100000000100111, expected: 0b11111111111111111111111111111101}, // rhs = -200261593 expected = -3
        TestCaseTwoArgs{lhs: 85818042, rhs: 0b10110011001011001010110010101001, expected: 0b11111111111111111111111111111111}, // rhs = -1288917847 expected = -1
        TestCaseTwoArgs{lhs: 0b11000001000110110110110010110011, rhs: 0b11000101001010100010001101001100, expected: 1}, // lhs = -1055167309 rhs = -987094196
        TestCaseTwoArgs{lhs: 1010838073, rhs: 0b10111000000101001111111001010100, expected: 0b11111111111111111111111111111111}, // rhs = -1206583724 expected = -1
        TestCaseTwoArgs{lhs: 0b11011010101111110111111001000110, rhs: 0b10011010110000010110100101101101, expected: 0}, // lhs = -624984506 rhs = -1698600595
        TestCaseTwoArgs{lhs: 0b10111110110011000111010001110000, rhs: 1241306534, expected: 0b11111111111111111111111111111111}, // lhs = -1093897104 expected = -1
        TestCaseTwoArgs{lhs: 1709641296, rhs: 406914149, expected: 4},
        TestCaseTwoArgs{lhs: 0b11000110100011011110101110010011, rhs: 0b10001011010100100010010011010111, expected: 0}, // lhs = -963777645 rhs = -1957550889
        TestCaseTwoArgs{lhs: 1879947782, rhs: 1493207360, expected: 1},
        TestCaseTwoArgs{lhs: 93117934, rhs: 0b11111001101111011110010100111010, expected: 0b11111111111111111111111111111111}, // rhs = -104995526 expected = -1
        TestCaseTwoArgs{lhs: 738921040, rhs: 0b11111011001000001001101000110111, expected: 0b11111111111111111111111111110110}, // rhs = -81749449 expected = -10
        TestCaseTwoArgs{lhs: 0b10100101000001011000100001010000, rhs: 1784094794, expected: 0b11111111111111111111111111111111}, // lhs = -1526364080 expected = -1
        TestCaseTwoArgs{lhs: 0b11100000001011000101100011111100, rhs: 0b11001010111101110000000101010011, expected: 0}, // lhs = -533964548 rhs = -889781933
        TestCaseTwoArgs{lhs: 0b10010101010100000001110011000111, rhs: 988938587, expected: 0b11111111111111111111111111111110}, // lhs = -1789911865 expected = -2
        TestCaseTwoArgs{lhs: 1847068167, rhs: 1049212998, expected: 1},
        TestCaseTwoArgs{lhs: 1914559389, rhs: 2089368283, expected: 0},
        TestCaseTwoArgs{lhs: 0b11000001100110010101011110101001, rhs: 0b11110101111111010011000011111010, expected: 6}, // lhs = -1046915159 rhs = -167956230
        TestCaseTwoArgs{lhs: 1010356367, rhs: 0b11111011111001010000110010111111, expected: 0b11111111111111111111111111110001}, // rhs = -68875073 expected = -15
        TestCaseTwoArgs{lhs: 0b11000101110111110001011100000110, rhs: 0b11110001010101101110001110011010, expected: 3}, // lhs = -975235322 rhs = -245963878
        TestCaseTwoArgs{lhs: 1768796506, rhs: 322186041, expected: 5},
        TestCaseTwoArgs{lhs: 1165460507, rhs: 0b10010010000100110101110101001110, expected: 0b11111111111111111111111111111111}, // rhs = -1844224690 expected = -1
        TestCaseTwoArgs{lhs: 117550653, rhs: 0b11001001001110010010001101110000, expected: 0b11111111111111111111111111111111}, // rhs = -919002256 expected = -1
        TestCaseTwoArgs{lhs: 0b11101110000110011101110110000111, rhs: 397815742, expected: 0b11111111111111111111111111111111}, // lhs = -300294777 expected = -1
        TestCaseTwoArgs{lhs: 0b11001011000010010110110101100000, rhs: 71997690, expected: 0b11111111111111111111111111110011}, // lhs = -888574624 expected = -13
        TestCaseTwoArgs{lhs: 2033681498, rhs: 0b11001000101100000100010111111011, expected: 0b11111111111111111111111111111101}, // rhs = -927971845 expected = -3
        TestCaseTwoArgs{lhs: 1799126092, rhs: 1277177821, expected: 1},
        TestCaseTwoArgs{lhs: 2144033234, rhs: 0b10100001101011111110000001110110, expected: 0b11111111111111111111111111111110}, // rhs = -1582309258 expected = -2
        TestCaseTwoArgs{lhs: 0b11001001010111011000001011000110, rhs: 0b10001010101100001000000101010001, expected: 0}, // lhs = -916618554 rhs = -1968144047
        TestCaseTwoArgs{lhs: 624259320, rhs: 34320994, expected: 18},
        TestCaseTwoArgs{lhs: 0b11000110101011010110111101110101, rhs: 0b10101110101000000100101100000110, expected: 0}, // lhs = -961712267 rhs = -1365226746
        TestCaseTwoArgs{lhs: 135984662, rhs: 0b11101010111010100011101000000111, expected: 0b11111111111111111111111111111111}, // rhs = -353748473 expected = -1
        TestCaseTwoArgs{lhs: 0b11001101101011011100000111000111, rhs: 1722223684, expected: 0b11111111111111111111111111111111}, // lhs = -844250681 expected = -1
        TestCaseTwoArgs{lhs: 551839200, rhs: 333300646, expected: 1},
        TestCaseTwoArgs{lhs: 0b11001101001000011100001011100110, rhs: 0b10111111101101110011101000110110, expected: 0}, // lhs = -853425434 rhs = -1078511050
        TestCaseTwoArgs{lhs: 831187674, rhs: 0b10111000100010011010000101011101, expected: 0b11111111111111111111111111111111}, // rhs = -1198939811 expected = -1
        TestCaseTwoArgs{lhs: 210808230, rhs: 0b10110010011110011110100001101110, expected: 0b11111111111111111111111111111111}, // rhs = -1300633490 expected = -1
        TestCaseTwoArgs{lhs: 0b10011110010110111111100100000110, rhs: 0b10110110101011111111000110101011, expected: 1}, // lhs = -1638139642 rhs = -1229983317
        TestCaseTwoArgs{lhs: 0b11101100111001100011111000110010, rhs: 0b11100100010111000011101000010001, expected: 0}, // lhs = -320455118 rhs = -463717871
        TestCaseTwoArgs{lhs: 1379409130, rhs: 854469137, expected: 1},
        TestCaseTwoArgs{lhs: 1996167084, rhs: 0b10000011110100010000001010001000, expected: 0b11111111111111111111111111111111}, // rhs = -2083454328 expected = -1
        TestCaseTwoArgs{lhs: 0b10101010100011100001101110011111, rhs: 1025811329, expected: 0b11111111111111111111111111111110}, // lhs = -1433527393 expected = -2
        TestCaseTwoArgs{lhs: 0b10110001000011111111100000000011, rhs: 0b11100100000111101110100111001001, expected: 2}, // lhs = -1324353533 rhs = -467736119
        TestCaseTwoArgs{lhs: 0b11100010000111110010100010111001, rhs: 0b11101000101101101000111011100010, expected: 1}, // lhs = -501274439 rhs = -390689054
        TestCaseTwoArgs{lhs: 2029734799, rhs: 0b10100001000010000101000000111101, expected: 0b11111111111111111111111111111110}, // rhs = -1593290691 expected = -2
        TestCaseTwoArgs{lhs: 0b10011101000001001101110011000010, rhs: 171575543, expected: 0b11111111111111111111111111110110}, // lhs = -1660625726 expected = -10
        TestCaseTwoArgs{lhs: 1491722422, rhs: 0b11000111101110110111111101001110, expected: 0b11111111111111111111111111111110}, // rhs = -944013490 expected = -2
        TestCaseTwoArgs{lhs: 0b10011100000001001101011110100111, rhs: 0b10110100000010101000100110010101, expected: 1}, // lhs = -1677404249 rhs = -1274377835
        TestCaseTwoArgs{lhs: 1738322286, rhs: 0b10000100110010111000101110010111, expected: 0b11111111111111111111111111111111}, // rhs = -2067035241 expected = -1
        TestCaseTwoArgs{lhs: 0b10000001011100110001001001011101, rhs: 1138702290, expected: 0b11111111111111111111111111111110}, // lhs = -2123165091 expected = -2
        TestCaseTwoArgs{lhs: 1617245839, rhs: 0b10110111101011001101011011110111, expected: 0b11111111111111111111111111111110}, // rhs = -1213409545 expected = -2
        TestCaseTwoArgs{lhs: 0b11011100000001001010101101110000, rhs: 1258104557, expected: 0b11111111111111111111111111111111}, // lhs = -603673744 expected = -1
        TestCaseTwoArgs{lhs: 342010136, rhs: 0b11111001110011001011011010110011, expected: 0b11111111111111111111111111111100}, // rhs = -104024397 expected = -4
        TestCaseTwoArgs{lhs: 0b10011000010101101010001001001001, rhs: 0b11001111000001010001010101101001, expected: 2}, // lhs = -1739152823 rhs = -821750423
        TestCaseTwoArgs{lhs: 1230853885, rhs: 1287250649, expected: 0},
        TestCaseTwoArgs{lhs: 0b10010110110110101000110011111100, rhs: 60594629, expected: 0b11111111111111111111111111100010}, // lhs = -1764061956 expected = -30
        TestCaseTwoArgs{lhs: 167095403, rhs: 2055707633, expected: 0},
        TestCaseTwoArgs{lhs: 0b11110101001111010110110010100101, rhs: 74675826, expected: 0b11111111111111111111111111111101}, // lhs = -180523867 expected = -3
        TestCaseTwoArgs{lhs: 1636935037, rhs: 0b11100011111111011010111010011011, expected: 0b11111111111111111111111111111100}, // rhs = -469913957 expected = -4
        TestCaseTwoArgs{lhs: 2079719180, rhs: 2012983710, expected: 1},
        TestCaseTwoArgs{lhs: 0b11111000000100001101101110110100, rhs: 944161397, expected: 0b11111111111111111111111111111111}, // lhs = -133112908 expected = -1
        TestCaseTwoArgs{lhs: 301453334, rhs: 0b11001101001001100100101101110101, expected: 0b11111111111111111111111111111111}, // rhs = -853128331 expected = -1
        TestCaseTwoArgs{lhs: 0b11010111110010011010010110111011, rhs: 239544119, expected: 0b11111111111111111111111111111101}, // lhs = -674650693 expected = -3
        TestCaseTwoArgs{lhs: 1201766193, rhs: 0b11001001110100100000011010011010, expected: 0b11111111111111111111111111111110}, // rhs = -908982630 expected = -2
        TestCaseTwoArgs{lhs: 855405259, rhs: 0b11000001010011100111111010101101, expected: 0b11111111111111111111111111111111}, // rhs = -1051820371 expected = -1
        TestCaseTwoArgs{lhs: 2031521471, rhs: 0b11101011100101001011011100111011, expected: 0b11111111111111111111111111111010}, // rhs = -342575301 expected = -6
        TestCaseTwoArgs{lhs: 0b10110000111110010100100110001111, rhs: 106679994, expected: 0b11111111111111111111111111110011}, // lhs = -1325839985 expected = -13
        TestCaseTwoArgs{lhs: 552350764, rhs: 0b11111011110000010101111011100100, expected: 0b11111111111111111111111111111000}, // rhs = -71213340 expected = -8
        TestCaseTwoArgs{lhs: 0b11101111100001111101011101001001, rhs: 1861488568, expected: 0b11111111111111111111111111111111}, // lhs = -276310199 expected = -1
        TestCaseTwoArgs{lhs: 0b11101101000111101010110101010110, rhs: 1715188949, expected: 0b11111111111111111111111111111111}, // lhs = -316756650 expected = -1
        TestCaseTwoArgs{lhs: 1693485014, rhs: 1019302576, expected: 1},
        TestCaseTwoArgs{lhs: 0b11000001010000101101101110101011, rhs: 0b10000000001111010000001011011100, expected: 0}, // lhs = -1052582997 rhs = -2143485220
        TestCaseTwoArgs{lhs: 0b11101101110000000110100001110110, rhs: 1248205312, expected: 0b11111111111111111111111111111111}, // lhs = -306157450 expected = -1
        TestCaseTwoArgs{lhs: 0b10001110111001011111010111001000, rhs: 1496630492, expected: 0b11111111111111111111111111111110}, // lhs = -1897531960 expected = -2
        TestCaseTwoArgs{lhs: 0b10011101110111010001010000011111, rhs: 0b11100001101111111100010100101101, expected: 3}, // lhs = -1646455777 rhs = -507525843

        // Edge cases
        TestCaseTwoArgs{lhs: 0, rhs: 2147483647, expected: 0},
        TestCaseTwoArgs{lhs: 0, rhs: 0b10000000000000000000000000000000, expected: 0}, // rhs = -2147483648
        TestCaseTwoArgs{lhs: 2147483647, rhs: 2147483647, expected: 1},
        TestCaseTwoArgs{lhs: 2147483647, rhs: 0b10000000000000000000000000000000, expected: 0b11111111111111111111111111111111}, // rhs = -2147483648 expected = -1
        TestCaseTwoArgs{lhs: 0b10000000000000000000000000000000, rhs: 2147483647, expected: 0b11111111111111111111111111111110}, // lhs = -2147483648 expected = -2
        TestCaseTwoArgs{lhs: 0b10000000000000000000000000000000, rhs: 0b10000000000000000000000000000000, expected: 1}, // lhs = -2147483648 rhs = -2147483648
    ];
    #[test]
    fn test_i32() {
        for case in test_cases.span() {
            let mut state = RTStateOps::new();
            assert_eq!(__llvm_sdiv_i_i_i(ref state, *case.lhs, *case.rhs), *case.expected);
        }
    }
}
