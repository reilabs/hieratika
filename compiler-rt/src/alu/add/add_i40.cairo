use crate::alu::add::add;
use crate::integer::u40::u40;

pub fn __llvm_add_n_n_n(lhs: u128, rhs: u128) -> u128 {
    add::<u40>(lhs, rhs)
}

#[cfg(test)]
mod tests {
    use super::__llvm_add_n_n_n;
    use crate::alu::test_case::TestCaseTwoArgs;
    #[cairofmt::skip]
    pub const test_cases: [TestCaseTwoArgs; 129] = [
        // Due to Cairo's casting limitation, negative numbers are represented as bit patterns.

        // Random test cases
        TestCaseTwoArgs{lhs: 0b1110100110001001110101001101111101101100, rhs: 81850067565, expected: 1084889876953}, // lhs = -96471818388
        TestCaseTwoArgs{lhs: 18545742475, rhs: 0b1110101010011111100010111011010010010010, expected: 1026244822813}, // rhs = -91812547438
        TestCaseTwoArgs{lhs: 0b1001010101001101101000011100110111011000, rhs: 292954852561, expected: 934207429289}, // lhs = -458259051048
        TestCaseTwoArgs{lhs: 145200752711, rhs: 0b1101100100110000111101011010001010101110, expected: 1078030060277}, // rhs = -166682320210
        TestCaseTwoArgs{lhs: 270275608887, rhs: 430971128903, expected: 701246737790},
        TestCaseTwoArgs{lhs: 0b1100010000100100011001001011101010000000, rhs: 302689826089, expected: 45602369449}, // lhs = -257087456640
        TestCaseTwoArgs{lhs: 311724424855, rhs: 0b1111110101111010001010010110101001010011, expected: 300889057514}, // rhs = -10835367341
        TestCaseTwoArgs{lhs: 435618843138, rhs: 0b1010010100110011011011101011100011010111, expected: 45639713497}, // rhs = -389979129641
        TestCaseTwoArgs{lhs: 247728977503, rhs: 369804716260, expected: 617533693763},
        TestCaseTwoArgs{lhs: 86011023339, rhs: 508442636215, expected: 594453659554},
        TestCaseTwoArgs{lhs: 0b1101000000110101100000111001100110100101, rhs: 516512997075, expected: 311252383864}, // lhs = -205260613211
        TestCaseTwoArgs{lhs: 125701145574, rhs: 0b1100111101001011010001101111001111010011, expected: 1016022316985}, // rhs = -209190456365
        TestCaseTwoArgs{lhs: 0b1000111100010100111000001110010101101000, rhs: 323696685670, expected: 938227292110}, // lhs = -484981021336
        TestCaseTwoArgs{lhs: 501782119765, rhs: 0b1111011100101111100101001010110011010010, expected: 463925686823}, // rhs = -37856432942
        TestCaseTwoArgs{lhs: 0b1010111000111110011101101000000000111100, rhs: 0b1001000111100010010001111100101101010110, expected: 275427249042}, // lhs = -351139364804 rhs = -472945013930
        TestCaseTwoArgs{lhs: 484331227384, rhs: 0b1110100010011111110001100110011101101101, expected: 383932592229}, // rhs = -100398635155
        TestCaseTwoArgs{lhs: 0b1001110000110001001100000111001010000000, rhs: 0b1110011101101011101010100110101001101101, expected: 565272304877}, // lhs = -428671470976 rhs = -105567851923
        TestCaseTwoArgs{lhs: 91038042926, rhs: 0b1100011111010000110111001110001101001011, expected: 949240671865}, // rhs = -241308998837
        TestCaseTwoArgs{lhs: 72775306691, rhs: 474995398468, expected: 547770705159},
        TestCaseTwoArgs{lhs: 0b1010010000011011010001101100111101000011, rhs: 0b1000111001011011111001010101011000011100, expected: 216747746655}, // lhs = -394679365821 rhs = -488084515300
        TestCaseTwoArgs{lhs: 0b1000001001010000011100011111001010101101, rhs: 307692918066, expected: 867388311519}, // lhs = -539816234323
        TestCaseTwoArgs{lhs: 0b1011000110110000010101110011111111011010, rhs: 507925817086, expected: 171581908696}, // lhs = -336343908390
        TestCaseTwoArgs{lhs: 0b1110010011000111101101001011101110001011, rhs: 810645800, expected: 983413699763}, // lhs = -116908573813
        TestCaseTwoArgs{lhs: 0b1111011111111001001101010110110010000000, rhs: 0b1001101110011111010100011100001001110111, expected: 633919188727}, // lhs = -34473677696 rhs = -431118761353
        TestCaseTwoArgs{lhs: 0b1110001011100101001100110100101101000110, rhs: 525726512794, expected: 400722837984}, // lhs = -125003674810
        TestCaseTwoArgs{lhs: 373462154715, rhs: 0b1111010110100110000100100011110011100111, expected: 329003727554}, // rhs = -44458427161
        TestCaseTwoArgs{lhs: 0b1110011110011001101010110001111001001101, rhs: 0b1000000110100011010001110101011100110111, expected: 451994088836}, // lhs = -104796053939 rhs = -542721485001
        TestCaseTwoArgs{lhs: 92438540134, rhs: 0b1100101010011000000000100001100000100000, expected: 962572208006}, // rhs = -229377959904
        TestCaseTwoArgs{lhs: 107285382103, rhs: 197442830397, expected: 304728212500},
        TestCaseTwoArgs{lhs: 134415173488, rhs: 0b1001001001001111000011111000100110111010, expected: 762806817066}, // rhs = -471119984198
        TestCaseTwoArgs{lhs: 0b1000010011100010101000111100101100101000, rhs: 346527543040, expected: 917265611304}, // lhs = -528773559512
        TestCaseTwoArgs{lhs: 506983780756, rhs: 12409225647, expected: 519393006403},
        TestCaseTwoArgs{lhs: 425788983141, rhs: 21407877034, expected: 447196860175},
        TestCaseTwoArgs{lhs: 0b1000000110011100001001000000011101011111, rhs: 0b1000001010110001010001011011111111001011, expected: 18478647082}, // lhs = -542841239713 rhs = -538191740981
        TestCaseTwoArgs{lhs: 0b1000100011100001110101100100010000101110, rhs: 0b1011101110101001100000001010111000011000, expected: 294395507270}, // lhs = -511607159762 rhs = -293508960744
        TestCaseTwoArgs{lhs: 0b1100100001111101001000000000110011011101, rhs: 421315162174, expected: 182896246043}, // lhs = -238418916131
        TestCaseTwoArgs{lhs: 0b1101111111010010001110010101111100110111, rhs: 0b1001001010100011111101001001010000110011, expected: 491608994666}, // lhs = -138206945481 rhs = -469695687629
        TestCaseTwoArgs{lhs: 326534992533, rhs: 496276161675, expected: 822811154208},
        TestCaseTwoArgs{lhs: 188421026267, rhs: 497484912607, expected: 685905938874},
        TestCaseTwoArgs{lhs: 0b1001101010010101000000000101100110000011, rhs: 0b1110011100000111111110011000011111101111, expected: 556684403058}, // lhs = -435586836093 rhs = -107240388625
        TestCaseTwoArgs{lhs: 395750307562, rhs: 103925592777, expected: 499675900339},
        TestCaseTwoArgs{lhs: 356652854271, rhs: 0b1001110100011011111111011001001110000111, expected: 1031432322950}, // rhs = -424732159097
        TestCaseTwoArgs{lhs: 125435700682, rhs: 46040766186, expected: 171476466868},
        TestCaseTwoArgs{lhs: 333495327025, rhs: 0b1101001100111011110011011100000001000111, expected: 141225138552}, // rhs = -192270188473
        TestCaseTwoArgs{lhs: 0b1111100000111001111000010110100010100000, rhs: 0b1011010110100101101000011100010100011101, expected: 746779258301}, // lhs = -33388664672 rhs = -319343704803
        TestCaseTwoArgs{lhs: 0b1000111110001011011100010100010111000100, rhs: 176705965967, expected: 793225745747}, // lhs = -482991847996
        TestCaseTwoArgs{lhs: 271054696832, rhs: 461637195829, expected: 732691892661},
        TestCaseTwoArgs{lhs: 62282778846, rhs: 323669411746, expected: 385952190592},
        TestCaseTwoArgs{lhs: 220554629870, rhs: 80116888812, expected: 300671518682},
        TestCaseTwoArgs{lhs: 176333899402, rhs: 395261760961, expected: 571595660363},
        TestCaseTwoArgs{lhs: 114662255109, rhs: 383519745926, expected: 498182001035},
        TestCaseTwoArgs{lhs: 372909784373, rhs: 0b1011110011010110010000110001010010100111, expected: 84446728668}, // rhs = -288463055705
        TestCaseTwoArgs{lhs: 423496889082, rhs: 525575689691, expected: 949072578773},
        TestCaseTwoArgs{lhs: 383386037692, rhs: 0b1010111100110001101100010010011111110110, expected: 36327380402}, // rhs = -347058657290
        TestCaseTwoArgs{lhs: 0b1001010000011010000111100101100111001011, rhs: 11095434241, expected: 647188790732}, // lhs = -463418271285
        TestCaseTwoArgs{lhs: 0b1001001010101100101110000010111101000010, rhs: 0b1010111001110100111001000111011001011010, expected: 279736788380}, // lhs = -469548650686 rhs = -350226188710
        TestCaseTwoArgs{lhs: 397781246251, rhs: 516378486515, expected: 914159732766},
        TestCaseTwoArgs{lhs: 129397321184, rhs: 0b1001001001010111100000111100110000110001, expected: 757930801681}, // rhs = -470978147279
        TestCaseTwoArgs{lhs: 219732503214, rhs: 525977709211, expected: 745710212425},
        TestCaseTwoArgs{lhs: 372367399797, rhs: 0b1010101101101111101010111010100010110111, expected: 9168700460}, // rhs = -363198699337
        TestCaseTwoArgs{lhs: 396874492675, rhs: 0b1101010110011100111100100011001100000001, expected: 214824017412}, // rhs = -182050475263
        TestCaseTwoArgs{lhs: 0b1101001110100011000001111111111110101001, rhs: 237489133984, expected: 46950816073}, // lhs = -190538317911
        TestCaseTwoArgs{lhs: 434179858470, rhs: 0b1000101010001100101001011101000111101110, expected: 1029245022740}, // rhs = -504446463506
        TestCaseTwoArgs{lhs: 0b1011011011000111100010100000100011011000, rhs: 87280188608, expected: 872311948696}, // lhs = -314479867688
        TestCaseTwoArgs{lhs: 0b1100111111000011110111110110110010111111, rhs: 0b1100111010111110000011001101110011011111, expected: 680784578974}, // lhs = -207167198017 rhs = -211559850785
        TestCaseTwoArgs{lhs: 0b1110000011110000111111010011011111111100, rhs: 69983085008, expected: 1036098886092}, // lhs = -133395826692
        TestCaseTwoArgs{lhs: 0b1100111011000011111111000100010100010100, rhs: 233910302859, expected: 22450027935}, // lhs = -211460274924
        TestCaseTwoArgs{lhs: 0b1110101111101011101001101011010000011010, rhs: 0b1100110000001100001001111110000001111100, expected: 790136525974}, // lhs = -86240742374 rhs = -223134359428
        TestCaseTwoArgs{lhs: 0b1100011110000101011010010011010001110010, rhs: 0b1111110100011100111111001100010110000000, expected: 844538182130}, // lhs = -242574871438 rhs = -12398574208
        TestCaseTwoArgs{lhs: 179143118318, rhs: 216548003801, expected: 395691122119},
        TestCaseTwoArgs{lhs: 0b1000001001001001000100110110010011101111, rhs: 280316909766, expected: 839888666037}, // lhs = -539939871505
        TestCaseTwoArgs{lhs: 312106705381, rhs: 0b1010001001110011010101110110010100001100, expected: 1009826514673}, // rhs = -401791818484
        TestCaseTwoArgs{lhs: 342871711451, rhs: 0b1001111000101001001011000011100111010010, expected: 1022167308461}, // rhs = -420216030766
        TestCaseTwoArgs{lhs: 0b1010000110100101100110100111110001011111, rhs: 0b1110011011010001111011101100110101101101, expected: 586121038284}, // lhs = -405243528097 rhs = -108147061395
        TestCaseTwoArgs{lhs: 0b1100100001111101101010011100111010000010, rhs: 489479504464, expected: 251069616338}, // lhs = -238409888126
        TestCaseTwoArgs{lhs: 492526821768, rhs: 357992906687, expected: 850519728455},
        TestCaseTwoArgs{lhs: 0b1011000000011010011111110101110001110010, rhs: 427489679845, expected: 84336850519}, // lhs = -343152829326
        TestCaseTwoArgs{lhs: 529283137625, rhs: 0b1010011100000010000011011011000110100010, expected: 147065500155}, // rhs = -382217637470
        TestCaseTwoArgs{lhs: 0b1000000101100010011100001011110001010011, rhs: 454955343652, expected: 1010657680247}, // lhs = -543809291181
        TestCaseTwoArgs{lhs: 0b1110000001001011011111111110001100001110, rhs: 0b1101011111010001111110110111001000010010, expected: 790768604448}, // lhs = -136172281074 rhs = -172570742254
        TestCaseTwoArgs{lhs: 310988835312, rhs: 152675583179, expected: 463664418491},
        TestCaseTwoArgs{lhs: 0b1001100010010110101011010000001001011101, rhs: 0b1101011101111000101000111111111000000001, expected: 481293303902}, // lhs = -444148678051 rhs = -174069645823
        TestCaseTwoArgs{lhs: 524103869076, rhs: 0b1001000001010110010010010010010010111000, expected: 44515166028}, // rhs = -479588703048
        TestCaseTwoArgs{lhs: 0b1110110101111111010110101000101001101100, rhs: 0b1100100111111111100111111111101101101101, expected: 788109362649}, // lhs = -79467738516 rhs = -231934526611
        TestCaseTwoArgs{lhs: 154020708205, rhs: 0b1000101000001111000011010101001111010001, expected: 746978726718}, // rhs = -506553609263
        TestCaseTwoArgs{lhs: 119692360459, rhs: 8086080517, expected: 127778440976},
        TestCaseTwoArgs{lhs: 0b1010101111101000000110010101100001001101, rhs: 524260617391, expected: 163082372348}, // lhs = -361178245043
        TestCaseTwoArgs{lhs: 82810215193, rhs: 95773768078, expected: 178583983271},
        TestCaseTwoArgs{lhs: 0b1111111011111111001001010001101010001111, rhs: 0b1001010100111110110000011000000010000001, expected: 636693682960}, // lhs = -4309312881 rhs = -458508631935
        TestCaseTwoArgs{lhs: 113156484990, rhs: 494560886998, expected: 607717371988},
        TestCaseTwoArgs{lhs: 0b1010010110110111000100110011010100110001, rhs: 93493024309, expected: 805234117478}, // lhs = -387770534607
        TestCaseTwoArgs{lhs: 0b1000010011011001101100011011100110011000, rhs: 94153250301, expected: 664741236629}, // lhs = -528923641448
        TestCaseTwoArgs{lhs: 388496740098, rhs: 0b1010111000011101010100010101110000001001, expected: 36801293067}, // rhs = -351695447031
        TestCaseTwoArgs{lhs: 0b1001000010100110011001101110110001110001, rhs: 390345373607, expected: 1011612427288}, // lhs = -478244574095
        TestCaseTwoArgs{lhs: 204804544794, rhs: 304145221735, expected: 508949766529},
        TestCaseTwoArgs{lhs: 0b1000010100000000100101010100011011010011, rhs: 0b1000110101110011100110101110101111010001, expected: 79258727076}, // lhs = -528271194413 rhs = -491981706287
        TestCaseTwoArgs{lhs: 0b1111101011001111010111111101010010000111, rhs: 0b1001010110110011101001000111001111000101, expected: 620673386572}, // lhs = -22290639737 rhs = -456547601467
        TestCaseTwoArgs{lhs: 0b1101001100111100011001100000011100101110, rhs: 524031623159, expected: 331771414309}, // lhs = -192260208850
        TestCaseTwoArgs{lhs: 281269301446, rhs: 0b1011010101000011110001111110010011000100, expected: 1059795555722}, // rhs = -320985373500
        TestCaseTwoArgs{lhs: 378175713915, rhs: 0b1000001101111110110110111100001000000100, expected: 942944760959}, // rhs = -534742580732
        TestCaseTwoArgs{lhs: 0b1011100010111100001001101010100111101110, rhs: 0b1011011101110110010011110001000101011010, expected: 481882913608}, // lhs = -306080994834 rhs = -311547719334
        TestCaseTwoArgs{lhs: 0b1010110010001010001111001001011101010101, rhs: 0b1011010000010011011100100101100101000011, expected: 414962348184}, // lhs = -358458026155 rhs = -326091253437
        TestCaseTwoArgs{lhs: 98381260260, rhs: 0b1101111111100001110001011111011101111011, expected: 1059946814815}, // rhs = -137946073221
        TestCaseTwoArgs{lhs: 0b1000111010001010010111100011111011011001, rhs: 0b1010101010001111101111010001011011100111, expected: 245251134912}, // lhs = -487304839463 rhs = -366955653401
        TestCaseTwoArgs{lhs: 0b1011100010111001110110010000010110101100, rhs: 0b1111000100111000011110000011000001010010, expected: 729914881534}, // lhs = -306119637588 rhs = -63477108654
        TestCaseTwoArgs{lhs: 312603124203, rhs: 0b1101101010001100110001000110111010110011, expected: 151756050590}, // rhs = -160847073613
        TestCaseTwoArgs{lhs: 0b1010011110101111101110001110010011001011, rhs: 0b1010100000011001001011000101100010010110, expected: 342672883041}, // lhs = -379303959349 rhs = -377534785386
        TestCaseTwoArgs{lhs: 221271232656, rhs: 0b1110101010001101010010001110111000100001, expected: 129152319153}, // rhs = -92118913503
        TestCaseTwoArgs{lhs: 82881312668, rhs: 0b1001101100011000100101001010011011000000, expected: 749013638748}, // rhs = -433379301696
        TestCaseTwoArgs{lhs: 0b1000111100100011010011000111101000010111, rhs: 475680119448, expected: 1090452657327}, // lhs = -484739089897
        TestCaseTwoArgs{lhs: 28108341383, rhs: 0b1111010110100001110010000000100111111000, expected: 1083089570431}, // rhs = -44530398728
        TestCaseTwoArgs{lhs: 0b1101101000011100101101100101011001101111, rhs: 387772538357, expected: 225045492836}, // lhs = -162727045521
        TestCaseTwoArgs{lhs: 282613571948, rhs: 65852466578, expected: 348466038526},
        TestCaseTwoArgs{lhs: 176149625849, rhs: 97788427460, expected: 273938053309},
        TestCaseTwoArgs{lhs: 0b1010100110111001100000101100001101110100, rhs: 470372828579, expected: 99823028503}, // lhs = -370549800076
        TestCaseTwoArgs{lhs: 454440522463, rhs: 0b1111000001110111100000011100111100101001, expected: 387726041608}, // rhs = -66714480855
        TestCaseTwoArgs{lhs: 21671449969, rhs: 0b1111000000100001110101010110110011000110, expected: 1053031236151}, // rhs = -68151841594
        TestCaseTwoArgs{lhs: 427896844824, rhs: 309302171133, expected: 737199015957},
        TestCaseTwoArgs{lhs: 484586240972, rhs: 0b1011000001010011000001111011100110001001, expected: 142381872469}, // rhs = -342204368503
        TestCaseTwoArgs{lhs: 0b1000001001010010101100000001010010011010, rhs: 0b1110001000010101011000111110011110111011, expected: 431242869845}, // lhs = -539778607974 rhs = -128490149957

        // Edge cases
        TestCaseTwoArgs{lhs: 0, rhs: 0, expected: 0},
        TestCaseTwoArgs{lhs: 0, rhs: 549755813887, expected: 549755813887},
        TestCaseTwoArgs{lhs: 0, rhs: 0b1000000000000000000000000000000000000000, expected: 549755813888}, // rhs = -549755813888
        TestCaseTwoArgs{lhs: 549755813887, rhs: 0, expected: 549755813887},
        TestCaseTwoArgs{lhs: 549755813887, rhs: 549755813887, expected: 1099511627774},
        TestCaseTwoArgs{lhs: 549755813887, rhs: 0b1000000000000000000000000000000000000000, expected: 1099511627775}, // rhs = -549755813888
        TestCaseTwoArgs{lhs: 0b1000000000000000000000000000000000000000, rhs: 0, expected: 549755813888}, // lhs = -549755813888
        TestCaseTwoArgs{lhs: 0b1000000000000000000000000000000000000000, rhs: 549755813887, expected: 1099511627775}, // lhs = -549755813888
        TestCaseTwoArgs{lhs: 0b1000000000000000000000000000000000000000, rhs: 0b1000000000000000000000000000000000000000, expected: 0}, // lhs = -549755813888 rhs = -549755813888
    ];
    #[test]
    fn test_i40() {
        for case in test_cases.span() {
            assert_eq!(__llvm_add_n_n_n(*case.lhs, *case.rhs), *case.expected);
        }
    }
}
